# MyBlog åç«¯ä¸ç®¡ç†å¹³å°å¼€å‘è®¡åˆ’

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

åŸºäºå‰ç«¯å·²æœ‰åŠŸèƒ½ï¼Œéœ€è¦å¼€å‘ï¼š

1. **åç«¯ API æœåŠ¡**ï¼šæä¾›æ•°æ®å­˜å‚¨å’Œä¸šåŠ¡é€»è¾‘
2. **ç®¡ç†å¹³å°**ï¼šå†…å®¹ç®¡ç†å’Œç³»ç»Ÿé…ç½®

### å‰ç«¯åŠŸèƒ½æ¨¡å—åˆ†æ

| æ¨¡å—   | æ•°æ®å®ä½“         | æ ¸å¿ƒåŠŸèƒ½                |
| ---- | ------------ | ------------------- |
| æ–‡ç« ç³»ç»Ÿ | Article      | æ–‡ç« åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ†ç±»ã€æ ‡ç­¾ã€é˜…è¯»é‡ç»Ÿè®¡ |
| è¯´è¯´ç³»ç»Ÿ | Moment       | å‘å¸ƒè¯´è¯´ã€ç‚¹èµã€å›¾ç‰‡ä¸Šä¼         |
| å‹é“¾ç³»ç»Ÿ | FriendLink   | å‹é“¾å±•ç¤ºã€ç”³è¯·             |
| å›¾åº“ç³»ç»Ÿ | GalleryImage | å›¾ç‰‡ä¸Šä¼ ã€åˆ†ç±»ç®¡ç†           |
| è¯„è®ºç³»ç»Ÿ | Comment      | è¯„è®ºå‘å¸ƒã€å±•ç¤º             |
| ç”¨æˆ·ç³»ç»Ÿ | User         | ç®¡ç†å‘˜ç™»å½•ã€æƒé™ç®¡ç†          |
| è®¿å®¢ç³»ç»Ÿ | Visitor      | è®¿å®¢ç™»å½•ã€è¯„è®ºå…³è”           |

***

## äºŒã€åç«¯ API å¼€å‘è®¡åˆ’

### 2.1 æŠ€æœ¯é€‰å‹ï¼ˆé’ˆå¯¹ 2æ ¸2G æœåŠ¡å™¨ä¼˜åŒ–ï¼‰

| å±‚çº§   | æŠ€æœ¯æ–¹æ¡ˆ                    | ç†ç”±               |
| ---- | ----------------------- | ---------------- |
| è¿è¡Œæ—¶  | Node.js + TypeScript    | ä¸å‰ç«¯æŠ€æœ¯æ ˆç»Ÿä¸€         |
| æ¡†æ¶   | Fastify                 | è½»é‡é«˜æ€§èƒ½ï¼Œå†…å­˜å ç”¨å°      |
| æ•°æ®åº“  | SQLite (better-sqlite3) | é›¶é…ç½®ã€æ— é¢å¤–è¿›ç¨‹ã€é€‚åˆå°å‹åº”ç”¨ |
| ORM  | Prisma                  | ç±»å‹å®‰å…¨ï¼ŒSQLite æ”¯æŒå®Œå–„ |
| ç¼“å­˜   | å†…å­˜ç¼“å­˜ (Map + å®šæ—¶æ¸…ç†)       | æ— éœ€é¢å¤–è¿›ç¨‹ï¼ŒèŠ‚çœå†…å­˜      |
| æ–‡ä»¶å­˜å‚¨ | é˜¿é‡Œäº‘ OSS / è…¾è®¯äº‘ COS       | äº‘å­˜å‚¨ï¼Œæ— éœ€æœ¬åœ°å­˜å‚¨æœåŠ¡     |
| è®¤è¯   | JWT                     | æ— çŠ¶æ€è®¤è¯ï¼Œæ— éœ€ä¼šè¯å­˜å‚¨     |

### 2.2 ä¸ºä»€ä¹ˆé€‰æ‹© SQLiteï¼Ÿ

| å¯¹æ¯”é¡¹   | SQLite    | PostgreSQL |
| ----- | --------- | ---------- |
| å†…å­˜å ç”¨  | \~10MB    | \~50-100MB |
| é¢å¤–è¿›ç¨‹  | æ—          | éœ€è¦ç‹¬ç«‹è¿›ç¨‹     |
| é…ç½®å¤æ‚åº¦ | é›¶é…ç½®       | éœ€è¦é…ç½®ç”¨æˆ·ã€æƒé™ç­‰ |
| å¹¶å‘å†™å…¥  | å•å†™å…¥       | å¤šå†™å…¥        |
| é€‚ç”¨åœºæ™¯  | å°å‹åšå®¢ã€ä¸ªäººé¡¹ç›® | å¤§å‹åº”ç”¨ã€é«˜å¹¶å‘   |

**ç»“è®º**ï¼šä¸ªäººåšå®¢è®¿é—®é‡æœ‰é™ï¼ŒSQLite å®Œå…¨å¤Ÿç”¨ï¼Œä¸”èŠ‚çœ 50-100MB å†…å­˜ã€‚

### 2.3 é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.ts      # ç»Ÿä¸€é…ç½®
â”‚   â”‚   â””â”€â”€ storage.ts    # äº‘å­˜å‚¨é…ç½®
â”‚   â”œâ”€â”€ modules/          # ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth/         # è®¤è¯æ¨¡å—ï¼ˆç®¡ç†å‘˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ visitor/      # è®¿å®¢æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ article/      # æ–‡ç« æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ moment/       # è¯´è¯´æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ gallery/      # å›¾åº“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ friend/       # å‹é“¾æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ comment/      # è¯„è®ºæ¨¡å—
â”‚   â”‚   â””â”€â”€ upload/       # ä¸Šä¼ æ¨¡å—
â”‚   â”œâ”€â”€ common/           # å…¬å…±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ middleware/   # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ cache.ts      # å†…å­˜ç¼“å­˜
â”‚   â”‚   â””â”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ prisma/           # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â””â”€â”€ schema.prisma
â”‚   â””â”€â”€ app.ts            # åº”ç”¨å…¥å£
â”œâ”€â”€ data/                 # SQLite æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ blog.db
â”œâ”€â”€ tests/
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 2.4 æ•°æ®åº“è®¾è®¡

```prisma
// prisma/schema.prisma

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./data/blog.db"
}

// ==================== ç”¨æˆ·ç³»ç»Ÿ ====================

// ç®¡ç†å‘˜
model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String   // bcrypt åŠ å¯†
  nickname  String
  avatar    String?
  email     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  articles  Article[]
  moments   Moment[]
}

// è®¿å®¢ï¼ˆè¯„è®ºè€…ï¼‰
model Visitor {
  id           Int       @id @default(autoincrement())
  nickname     String
  email        String    @unique
  avatar       String?   // Gravatar æˆ–è‡ªå®šä¹‰å¤´åƒ
  provider     String    @default("email") // email, github, wechat
  providerId   String?   // OAuth æä¾›å•†çš„ç”¨æˆ· ID
  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  
  comments     Comment[]
  likes        Like[]
  
  @@index([email])
  @@index([provider, providerId])
}

// ==================== å†…å®¹ç³»ç»Ÿ ====================

model Article {
  id        Int      @id @default(autoincrement())
  title     String
  excerpt   String
  content   String   @db.Text
  cover     String?  // å°é¢å›¾
  category  String
  views     Int      @default(0)
  status    Int      @default(0) // 0: draft, 1: published
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  authorId  Int
  author    Admin    @relation(fields: [authorId], references: [id])
  tags      ArticleTag[]
  comments  Comment[]
  
  @@index([category])
  @@index([status, createdAt])
}

model ArticleTag {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  articles Article[]
}

model Moment {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  images    String   @db.Text // JSON array
  likes     Int      @default(0)
  createdAt DateTime @default(now())
  
  authorId  Int
  author    Admin    @relation(fields: [authorId], references: [id])
  comments  Comment[]
  likeRecords Like[]
  
  @@index([createdAt])
}

model GalleryImage {
  id          Int      @id @default(autoincrement())
  url         String
  thumbnail   String?
  title       String
  description String?
  category    String
  createdAt   DateTime @default(now())
  
  tags ImageTag[]
  
  @@index([category])
}

model ImageTag {
  id     Int           @id @default(autoincrement())
  name   String        @unique
  images GalleryImage[]
}

// ==================== äº’åŠ¨ç³»ç»Ÿ ====================

model FriendLink {
  id          Int      @id @default(autoincrement())
  name        String
  avatar      String
  url         String
  description String
  status      Int      @default(0) // 0: pending, 1: approved, 2: rejected
  createdAt   DateTime @default(now())
  
  @@index([status])
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  createdAt DateTime @default(now())
  
  visitorId Int
  visitor   Visitor  @relation(fields: [visitorId], references: [id])
  
  articleId Int?
  article   Article? @relation(fields: [articleId], references: [id])
  momentId  Int?
  moment    Moment?  @relation(fields: [momentId], references: [id])
  
  parentId  Int?
  parent    Comment? @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")
  
  @@index([articleId])
  @@index([momentId])
  @@index([visitorId])
}

model Like {
  id        Int      @id @default(autoincrement())
  visitorId Int
  visitor   Visitor  @relation(fields: [visitorId], references: [id])
  momentId  Int
  moment    Moment   @relation(fields: [momentId], references: [id])
  createdAt DateTime @default(now())
  
  @@unique([visitorId, momentId])
  @@index([momentId])
}

// ==================== ç³»ç»Ÿé…ç½® ====================

model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String   @db.Text
  updatedAt DateTime @updatedAt
}
```

### 2.5 è®¿å®¢ç™»å½•ç³»ç»Ÿè®¾è®¡

#### ç™»å½•æ–¹å¼

| æ–¹å¼           | æµç¨‹                       | ä¼˜ç‚¹       |
| ------------ | ------------------------ | -------- |
| é‚®ç®±éªŒè¯ç         | è¾“å…¥é‚®ç®± â†’ å‘é€éªŒè¯ç  â†’ éªŒè¯ç™»å½•      | æ— éœ€è®°å¯†ç ï¼Œå®‰å…¨ |
| GitHub OAuth | ç‚¹å‡» GitHub ç™»å½• â†’ æˆæƒ â†’ è·å–ä¿¡æ¯ | ä¾¿æ·ï¼Œä¿¡æ¯ä¸°å¯Œ  |
| å¾®ä¿¡æ‰«ç          | æ‰«ç  â†’ æˆæƒ â†’ è·å–ä¿¡æ¯           | å›½å†…ç”¨æˆ·å‹å¥½   |

#### é‚®ç®±éªŒè¯ç ç™»å½•æµç¨‹

```
1. è®¿å®¢è¾“å…¥é‚®ç®±
2. åç«¯ç”Ÿæˆ 6 ä½éªŒè¯ç ï¼Œå­˜å…¥å†…å­˜ç¼“å­˜ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆï¼‰
3. å‘é€é‚®ä»¶ï¼ˆä½¿ç”¨å…è´¹é‚®ä»¶æœåŠ¡å¦‚ Resendï¼‰
4. è®¿å®¢è¾“å…¥éªŒè¯ç 
5. éªŒè¯é€šè¿‡ï¼Œç”Ÿæˆ JWT Token
6. è¿”å›è®¿å®¢ä¿¡æ¯ï¼ˆæ˜µç§°é»˜è®¤ä»é‚®ç®±å‰ç¼€æå–ï¼‰
```

#### API æ¥å£

| æ–¹æ³•   | è·¯å¾„                        | è¯´æ˜              |
| ---- | ------------------------- | --------------- |
| POST | /api/visitor/code         | å‘é€éªŒè¯ç            |
| POST | /api/visitor/login        | éªŒè¯ç ç™»å½•           |
| GET  | /api/visitor/profile      | è·å–è®¿å®¢ä¿¡æ¯          |
| PUT  | /api/visitor/profile      | æ›´æ–°æ˜µç§°/å¤´åƒ         |
| GET  | /api/auth/github          | GitHub OAuth ç™»å½• |
| GET  | /api/auth/github/callback | GitHub OAuth å›è°ƒ |

### 2.6 API æ¥å£è®¾è®¡

#### è®¤è¯æ¨¡å— `/api/auth`

| æ–¹æ³•   | è·¯å¾„       | è¯´æ˜       |
| ---- | -------- | -------- |
| POST | /login   | ç®¡ç†å‘˜ç™»å½•    |
| POST | /logout  | é€€å‡ºç™»å½•     |
| GET  | /profile | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |

#### è®¿å®¢æ¨¡å— `/api/visitor`

| æ–¹æ³•   | è·¯å¾„       | è¯´æ˜           |
| ---- | -------- | ------------ |
| POST | /code    | å‘é€éªŒè¯ç         |
| POST | /login   | éªŒè¯ç ç™»å½•        |
| GET  | /profile | è·å–è®¿å®¢ä¿¡æ¯       |
| PUT  | /profile | æ›´æ–°è®¿å®¢ä¿¡æ¯       |
| GET  | /github  | GitHub OAuth |

#### æ–‡ç« æ¨¡å— `/api/articles`

| æ–¹æ³•     | è·¯å¾„        | è¯´æ˜          |
| ------ | --------- | ----------- |
| GET    | /         | æ–‡ç« åˆ—è¡¨ï¼ˆåˆ†é¡µã€åˆ†ç±»ï¼‰ |
| GET    | /:id      | æ–‡ç« è¯¦æƒ…        |
| POST   | /         | åˆ›å»ºæ–‡ç«  ğŸ”’     |
| PUT    | /:id      | æ›´æ–°æ–‡ç«  ğŸ”’     |
| DELETE | /:id      | åˆ é™¤æ–‡ç«  ğŸ”’     |
| POST   | /:id/view | å¢åŠ é˜…è¯»é‡       |

#### è¯´è¯´æ¨¡å— `/api/moments`

| æ–¹æ³•     | è·¯å¾„        | è¯´æ˜        |
| ------ | --------- | --------- |
| GET    | /         | è¯´è¯´åˆ—è¡¨      |
| GET    | /:id      | è¯´è¯´è¯¦æƒ…      |
| POST   | /         | å‘å¸ƒè¯´è¯´ ğŸ”’   |
| DELETE | /:id      | åˆ é™¤è¯´è¯´ ğŸ”’   |
| POST   | /:id/like | ç‚¹èµï¼ˆéœ€è®¿å®¢ç™»å½•ï¼‰ |
| DELETE | /:id/like | å–æ¶ˆç‚¹èµ      |

#### å›¾åº“æ¨¡å— `/api/gallery`

| æ–¹æ³•     | è·¯å¾„   | è¯´æ˜      |
| ------ | ---- | ------- |
| GET    | /    | å›¾ç‰‡åˆ—è¡¨    |
| GET    | /:id | å›¾ç‰‡è¯¦æƒ…    |
| POST   | /    | ä¸Šä¼ å›¾ç‰‡ ğŸ”’ |
| DELETE | /:id | åˆ é™¤å›¾ç‰‡ ğŸ”’ |

#### å‹é“¾æ¨¡å— `/api/friends`

| æ–¹æ³•     | è·¯å¾„     | è¯´æ˜      |
| ------ | ------ | ------- |
| GET    | /      | å‹é“¾åˆ—è¡¨    |
| POST   | /apply | ç”³è¯·å‹é“¾    |
| PUT    | /:id   | æ›´æ–°çŠ¶æ€ ğŸ”’ |
| DELETE | /:id   | åˆ é™¤å‹é“¾ ğŸ”’ |

#### è¯„è®ºæ¨¡å— `/api/comments`

| æ–¹æ³•     | è·¯å¾„   | è¯´æ˜          |
| ------ | ---- | ----------- |
| GET    | /    | è¯„è®ºåˆ—è¡¨        |
| POST   | /    | å‘è¡¨è¯„è®ºï¼ˆéœ€è®¿å®¢ç™»å½•ï¼‰ |
| DELETE | /:id | åˆ é™¤è¯„è®º ğŸ”’     |

#### ä¸Šä¼ æ¨¡å— `/api/upload`

| æ–¹æ³•   | è·¯å¾„     | è¯´æ˜      |
| ---- | ------ | ------- |
| POST | /image | ä¸Šä¼ å›¾ç‰‡ ğŸ”’ |

### 2.7 å†…å­˜ç¼“å­˜å®ç°

```typescript
// src/common/cache.ts

interface CacheItem<T> {
  value: T;
  expireAt: number;
}

class MemoryCache {
  private cache = new Map<string, CacheItem<unknown>>();
  private cleanupInterval: NodeJS.Timeout;

  constructor() {
    // æ¯åˆ†é’Ÿæ¸…ç†è¿‡æœŸç¼“å­˜
    this.cleanupInterval = setInterval(() => this.cleanup(), 60000);
  }

  get<T>(key: string): T | null {
    const item = this.cache.get(key);
    if (!item || Date.now() > item.expireAt) {
      this.cache.delete(key);
      return null;
    }
    return item.value as T;
  }

  set<T>(key: string, value: T, ttlSeconds: number): void {
    this.cache.set(key, {
      value,
      expireAt: Date.now() + ttlSeconds * 1000,
    });
  }

  delete(key: string): boolean {
    return this.cache.delete(key);
  }

  private cleanup(): void {
    const now = Date.now();
    for (const [key, item] of this.cache.entries()) {
      if (now > item.expireAt) {
        this.cache.delete(key);
      }
    }
  }
}

export const cache = new MemoryCache();
```

### 2.8 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ˆ2æ ¸2G é€‚é…ï¼‰

1. **å†…å­˜ä¼˜åŒ–**

   * SQLite æ›¿ä»£ PostgreSQLï¼šèŠ‚çœ 50-100MB

   * å†…å­˜ç¼“å­˜æ›¿ä»£ Redisï¼šèŠ‚çœ 20-50MB

   * äº‘å­˜å‚¨æ›¿ä»£ MinIOï¼šèŠ‚çœ 100MB+

   * é¢„è®¡åç«¯æœåŠ¡å†…å­˜å ç”¨ï¼š**80-120MB**

2. **æ•°æ®åº“ä¼˜åŒ–**

   * åˆç†ç´¢å¼•ï¼ˆåˆ†ç±»ã€æ—¶é—´ã€çŠ¶æ€ï¼‰

   * åˆ†é¡µæŸ¥è¯¢é™åˆ¶æ¡æ•°

   * ä½¿ç”¨ Prisma select åªæŸ¥éœ€è¦çš„å­—æ®µ

3. **ç¼“å­˜ç­–ç•¥**

   * æ–‡ç« åˆ—è¡¨ï¼š5 åˆ†é’Ÿ

   * çƒ­é—¨æ–‡ç« ï¼š30 åˆ†é’Ÿ

   * å‹é“¾åˆ—è¡¨ï¼š10 åˆ†é’Ÿ

   * éªŒè¯ç ï¼š5 åˆ†é’Ÿ

4. **è¿›ç¨‹ç®¡ç†**

   * ä½¿ç”¨ PM2 å•å®ä¾‹è¿è¡Œ

   * è®¾ç½®å†…å­˜é™åˆ¶ 256MBï¼Œè¶…é™è‡ªåŠ¨é‡å¯

### 2.9 å¼€å‘ä»»åŠ¡æ¸…å•

| ä¼˜å…ˆçº§ | ä»»åŠ¡                       | é¢„è®¡å·¥æ—¶ |
| --- | ------------------------ | ---- |
| P0  | é¡¹ç›®åˆå§‹åŒ–ã€Prisma + SQLite é…ç½® | 2h   |
| P0  | ç®¡ç†å‘˜è®¤è¯æ¨¡å—                  | 3h   |
| P0  | è®¿å®¢ç™»å½•æ¨¡å—ï¼ˆé‚®ç®±éªŒè¯ç ï¼‰            | 4h   |
| P0  | æ–‡ç«  CRUD + åˆ†ç±»æ ‡ç­¾           | 4h   |
| P1  | è¯´è¯´æ¨¡å— + ç‚¹èµåŠŸèƒ½              | 3h   |
| P1  | å›¾åº“æ¨¡å— + äº‘å­˜å‚¨ä¸Šä¼              | 3h   |
| P1  | å‹é“¾æ¨¡å— + ç”³è¯·æµç¨‹              | 2h   |
| P1  | è¯„è®ºæ¨¡å—ï¼ˆå…³è”è®¿å®¢ï¼‰               | 3h   |
| P2  | GitHub OAuth             | 2h   |
| P2  | å†…å­˜ç¼“å­˜é›†æˆ                   | 1h   |

***

## ä¸‰ã€ç®¡ç†å¹³å°å¼€å‘è®¡åˆ’

### 3.1 æŠ€æœ¯é€‰å‹

| å±‚çº§  | æŠ€æœ¯æ–¹æ¡ˆ                  | ç†ç”±     |
| --- | --------------------- | ------ |
| æ¡†æ¶  | React 19 + TypeScript | ä¸ä¸»ç«™ç»Ÿä¸€  |
| æ„å»º  | Vite                  | å¿«é€Ÿå¼€å‘   |
| UI  | Ant Design 5          | ä¼ä¸šçº§ç»„ä»¶  |
| çŠ¶æ€  | Zustand               | è½»é‡çº§    |
| è¯·æ±‚  | TanStack Query        | æ•°æ®ç¼“å­˜   |
| å¯Œæ–‡æœ¬ | TipTap                | ç°ä»£åŒ–ç¼–è¾‘å™¨ |

### 3.2 é¡¹ç›®ç»“æ„

```
admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/              # API è¯·æ±‚
â”‚   â”œâ”€â”€ components/       # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”œâ”€â”€ RichEditor/
â”‚   â”‚   â””â”€â”€ ImageUpload/
â”‚   â”œâ”€â”€ pages/            # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Login/
â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”œâ”€â”€ Article/
â”‚   â”‚   â”œâ”€â”€ Moment/
â”‚   â”‚   â”œâ”€â”€ Gallery/
â”‚   â”‚   â”œâ”€â”€ Friend/
â”‚   â”‚   â”œâ”€â”€ Comment/
â”‚   â”‚   â”œâ”€â”€ Visitor/      # è®¿å®¢ç®¡ç†
â”‚   â”‚   â””â”€â”€ Setting/
â”‚   â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ App.tsx
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.ts
```

### 3.3 é¡µé¢åŠŸèƒ½è®¾è®¡

#### ç™»å½•é¡µ `/login`

* ç”¨æˆ·åå¯†ç ç™»å½•

* è®°ä½ç™»å½•çŠ¶æ€

#### ä»ªè¡¨ç›˜ `/dashboard`

* æ–‡ç« ç»Ÿè®¡ï¼ˆæ€»æ•°ã€é˜…è¯»é‡ï¼‰

* è¯´è¯´ç»Ÿè®¡ï¼ˆæ€»æ•°ã€ç‚¹èµæ•°ï¼‰

* è¯„è®ºç»Ÿè®¡

* è®¿å®¢ç»Ÿè®¡

* æœ€è¿‘è¯„è®ºåˆ—è¡¨

#### æ–‡ç« ç®¡ç† `/articles`

* æ–‡ç« åˆ—è¡¨ï¼ˆæœç´¢ã€ç­›é€‰ã€æ‰¹é‡æ“ä½œï¼‰

* æ–°å»º/ç¼–è¾‘æ–‡ç« ï¼ˆå¯Œæ–‡æœ¬ã€Markdownã€å°é¢å›¾ã€åˆ†ç±»æ ‡ç­¾ï¼‰

#### è¯´è¯´ç®¡ç† `/moments`

* è¯´è¯´åˆ—è¡¨

* å‘å¸ƒè¯´è¯´ï¼ˆæ–‡æœ¬ã€å¤šå›¾ä¸Šä¼ ï¼‰

#### å›¾åº“ç®¡ç† `/gallery`

* å›¾ç‰‡ç½‘æ ¼å±•ç¤º

* æ‰¹é‡ä¸Šä¼ ã€åˆ†ç±»ç®¡ç†

#### å‹é“¾ç®¡ç† `/friends`

* å‹é“¾åˆ—è¡¨ã€å®¡æ ¸ç”³è¯·

#### è¯„è®ºç®¡ç† `/comments`

* è¯„è®ºåˆ—è¡¨ã€å›å¤ã€åˆ é™¤

#### è®¿å®¢ç®¡ç† `/visitors` â­ æ–°å¢

* è®¿å®¢åˆ—è¡¨ï¼ˆæ˜µç§°ã€é‚®ç®±ã€ç™»å½•æ–¹å¼ã€æœ€åç™»å½•æ—¶é—´ï¼‰

* è®¿å®¢è¯¦æƒ…ï¼ˆè¯„è®ºå†å²ã€ç‚¹èµè®°å½•ï¼‰

* ç¦è¨€/è§£ç¦åŠŸèƒ½

#### ç³»ç»Ÿè®¾ç½® `/settings`

* ä¸ªäººä¿¡æ¯ã€å¯†ç ä¿®æ”¹

* ç½‘ç«™é…ç½®

* é‚®ä»¶æœåŠ¡é…ç½®ï¼ˆSMTP/Resendï¼‰

* OAuth é…ç½®ï¼ˆGitHub Client ID/Secretï¼‰

### 3.4 å¼€å‘ä»»åŠ¡æ¸…å•

| ä¼˜å…ˆçº§ | ä»»åŠ¡          | é¢„è®¡å·¥æ—¶ |
| --- | ----------- | ---- |
| P0  | é¡¹ç›®åˆå§‹åŒ–ã€è·¯ç”±é…ç½®  | 2h   |
| P0  | ç™»å½•é¡µé¢ + è®¤è¯é€»è¾‘ | 3h   |
| P0  | å¸ƒå±€ç»„ä»¶        | 3h   |
| P0  | ä»ªè¡¨ç›˜é¡µé¢       | 3h   |
| P0  | æ–‡ç« ç®¡ç†        | 6h   |
| P1  | è¯´è¯´ç®¡ç†        | 3h   |
| P1  | å›¾åº“ç®¡ç†        | 4h   |
| P1  | å‹é“¾ç®¡ç†        | 2h   |
| P1  | è¯„è®ºç®¡ç†        | 2h   |
| P1  | è®¿å®¢ç®¡ç†        | 3h   |
| P2  | ç³»ç»Ÿè®¾ç½®        | 3h   |

***

## å››ã€éƒ¨ç½²æ¶æ„ï¼ˆ2æ ¸2G ä¼˜åŒ–ç‰ˆï¼‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Nginx     â”‚
                    â”‚  (åå‘ä»£ç†)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
         â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend â”‚     â”‚  Admin   â”‚     â”‚  Backend â”‚
   â”‚  (é™æ€)   â”‚     â”‚  (é™æ€)   â”‚     â”‚  (API)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                                    â”‚           â”‚
                                    â–¼           â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ SQLite   â”‚ â”‚ äº‘å­˜å‚¨  â”‚
                              â”‚ (æ–‡ä»¶)    â”‚ â”‚ (OSS)  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.1 èµ„æºå ç”¨é¢„ä¼°

| æœåŠ¡                | å†…å­˜å ç”¨        | CPU å ç”¨ |
| ----------------- | ----------- | ------ |
| Nginx             | \~10MB      | ä½      |
| Backend (Node.js) | \~100MB     | ä¸­      |
| SQLite            | \~10MB      | ä½      |
| **åˆè®¡**            | **\~120MB** | -      |

**å‰©ä½™å†…å­˜**ï¼šçº¦ 1.8GB å¯ç”¨äºç³»ç»Ÿç¼“å­˜å’Œå…¶ä»–æœåŠ¡ã€‚

### 4.2 éƒ¨ç½²é…ç½®

```bash
# PM2 é…ç½® ecosystem.config.js
module.exports = {
  apps: [{
    name: 'myblog-api',
    script: 'dist/app.js',
    instances: 1,
    max_memory_restart: '256M',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
}
```

### 4.3 Nginx é…ç½®

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    # å‰ç«¯
    location / {
        root /var/www/myblog/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # ç®¡ç†å¹³å°
    location /admin {
        root /var/www/myblog/admin/dist;
        try_files $uri $uri/ /admin/index.html;
    }

    # API
    location /api {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml;
}
```

***

## äº”ã€å¼€å‘æ—¶é—´çº¿

### ç¬¬ä¸€é˜¶æ®µï¼šåç«¯æ ¸å¿ƒï¼ˆé¢„è®¡ 2 å‘¨ï¼‰

| å‘¨  | ä»»åŠ¡                       |
| -- | ------------------------ |
| W1 | é¡¹ç›®åˆå§‹åŒ–ã€æ•°æ®åº“è®¾è®¡ã€ç®¡ç†å‘˜è®¤è¯ã€è®¿å®¢ç™»å½•   |
| W2 | æ–‡ç« æ¨¡å—ã€è¯´è¯´æ¨¡å—ã€å›¾åº“æ¨¡å—ã€å‹é“¾æ¨¡å—ã€è¯„è®ºæ¨¡å— |

### ç¬¬äºŒé˜¶æ®µï¼šç®¡ç†å¹³å°ï¼ˆé¢„è®¡ 2 å‘¨ï¼‰

| å‘¨  | ä»»åŠ¡                       |
| -- | ------------------------ |
| W3 | é¡¹ç›®åˆå§‹åŒ–ã€ç™»å½•è®¤è¯ã€å¸ƒå±€ç»„ä»¶ã€ä»ªè¡¨ç›˜      |
| W4 | æ–‡ç« ç®¡ç†ã€è¯´è¯´ç®¡ç†ã€å›¾åº“ç®¡ç†ã€è®¿å®¢ç®¡ç†ã€å…¶ä»–æ¨¡å— |

### ç¬¬ä¸‰é˜¶æ®µï¼šè”è°ƒéƒ¨ç½²ï¼ˆé¢„è®¡ 1 å‘¨ï¼‰

| ä»»åŠ¡    |
| ----- |
| å‰åç«¯è”è°ƒ |
| æ€§èƒ½ä¼˜åŒ–  |
| éƒ¨ç½²ä¸Šçº¿  |

***

## å…­ã€æŠ€æœ¯äº®ç‚¹

1. **è½»é‡æ¶æ„**ï¼šSQLite + å†…å­˜ç¼“å­˜ï¼Œ2æ ¸2G å®Œç¾è¿è¡Œ
2. **è®¿å®¢ç³»ç»Ÿ**ï¼šé‚®ç®±éªŒè¯ç ç™»å½• + OAuthï¼Œè¯„è®ºå¯è¿½æº¯
3. **ç±»å‹å®‰å…¨**ï¼šå‰åç«¯ TypeScript + Prisma
4. **é«˜æ€§èƒ½**ï¼šFastify + ç¼“å­˜ï¼Œå“åº” < 50ms
5. **ä»£ç ç®€æ´**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤

***

## ä¸ƒã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

ç¡®è®¤è®¡åˆ’åï¼Œå°†æŒ‰ä»¥ä¸‹é¡ºåºå¼€å‘ï¼š

1. åˆå§‹åŒ–åç«¯é¡¹ç›®ï¼ˆFastify + Prisma + SQLiteï¼‰
2. è®¾è®¡æ•°æ®åº“æ¨¡å‹å¹¶æ‰§è¡Œè¿ç§»
3. å®ç°ç®¡ç†å‘˜è®¤è¯æ¨¡å—
4. å®ç°è®¿å®¢ç™»å½•æ¨¡å—ï¼ˆé‚®ç®±éªŒè¯ç ï¼‰
5. å®ç°æ–‡ç« æ¨¡å—
6. å®ç°å…¶ä»–ä¸šåŠ¡æ¨¡å—
7. åˆå§‹åŒ–ç®¡ç†å¹³å°
8. å®ç°å„ç®¡ç†é¡µé¢
9. è”è°ƒéƒ¨ç½²

